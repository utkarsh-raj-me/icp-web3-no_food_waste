(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[108],{2112:function(e,t,a){Promise.resolve().then(a.bind(a,812))},812:function(e,t,a){"use strict";a.r(t),a.d(t,{default:function(){return R}});var s=a(7437),r=a(2265),i=a(4033),l=a(6110),n=a(3023),d=a(1908),c=a(9311);let o=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)("textarea",{className:(0,c.cn)("flex min-h-[80px] w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",a),ref:t,...r})});o.displayName="Textarea";var u=a(6743),m=a(9213);let h=(0,m.j)("text-sm font-medium leading-none peer-disabled:cursor-not-allowed peer-disabled:opacity-70"),x=r.forwardRef((e,t)=>{let{className:a,...r}=e;return(0,s.jsx)(u.f,{ref:t,className:(0,c.cn)(h(),a),...r})});x.displayName=u.f.displayName;var p=a(1291),g=a(7158),f=a(7015);function y(e){let{className:t,classNames:a,showOutsideDays:r=!0,...i}=e;return(0,s.jsx)(f._W,{showOutsideDays:r,className:(0,c.cn)("p-3",t),classNames:{months:"flex flex-col sm:flex-row space-y-4 sm:space-x-4 sm:space-y-0",month:"space-y-4",caption:"flex justify-center pt-1 relative items-center",caption_label:"text-sm font-medium",nav:"space-x-1 flex items-center",nav_button:(0,c.cn)((0,n.d)({variant:"outline"}),"h-7 w-7 bg-transparent p-0 opacity-50 hover:opacity-100"),nav_button_previous:"absolute left-1",nav_button_next:"absolute right-1",table:"w-full border-collapse space-y-1",head_row:"flex",head_cell:"text-muted-foreground rounded-md w-9 font-normal text-[0.8rem]",row:"flex w-full mt-2",cell:"h-9 w-9 text-center text-sm p-0 relative [&:has([aria-selected].day-range-end)]:rounded-r-md [&:has([aria-selected].day-outside)]:bg-accent/50 [&:has([aria-selected])]:bg-accent first:[&:has([aria-selected])]:rounded-l-md last:[&:has([aria-selected])]:rounded-r-md focus-within:relative focus-within:z-20",day:(0,c.cn)((0,n.d)({variant:"ghost"}),"h-9 w-9 p-0 font-normal aria-selected:opacity-100"),day_range_end:"day-range-end",day_selected:"bg-primary text-primary-foreground hover:bg-primary hover:text-primary-foreground focus:bg-primary focus:text-primary-foreground",day_today:"bg-accent text-accent-foreground",day_outside:"day-outside text-muted-foreground opacity-50 aria-selected:bg-accent/50 aria-selected:text-muted-foreground aria-selected:opacity-30",day_disabled:"text-muted-foreground opacity-50",day_range_middle:"aria-selected:bg-accent aria-selected:text-accent-foreground",day_hidden:"invisible",...a},components:{IconLeft:e=>{let{...t}=e;return(0,s.jsx)(p.Z,{className:"h-4 w-4"})},IconRight:e=>{let{...t}=e;return(0,s.jsx)(g.Z,{className:"h-4 w-4"})}},...i})}y.displayName="Calendar";var j=a(5050);let v=j.fC,b=j.xz,N=r.forwardRef((e,t)=>{let{className:a,align:r="center",sideOffset:i=4,...l}=e;return(0,s.jsx)(j.h_,{children:(0,s.jsx)(j.VY,{ref:t,align:r,sideOffset:i,className:(0,c.cn)("z-50 w-72 rounded-md border bg-popover p-4 text-popover-foreground shadow-md outline-none data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 data-[side=bottom]:slide-in-from-top-2 data-[side=left]:slide-in-from-right-2 data-[side=right]:slide-in-from-left-2 data-[side=top]:slide-in-from-bottom-2",a),...l})})});N.displayName=j.VY.displayName;var w=a(9314),_=a(8203),C=a(2549),P=a(3715),k=a(6055),L=a(6691),S=a.n(L),q=a(4430),F=a(3644),I=a(8094),z=a(3015),E=a(1541);function R(){let e=(0,i.useRouter)(),{toast:t}=(0,k.pm)(),{refreshUserData:a,refreshListings:u}=(0,F.useApp)(),{principal:m}=(0,z.useAuthContext)(),[h,p]=(0,r.useState)(!1),[g,f]=(0,r.useState)([]),[j,L]=(0,r.useState)(),[R,D]=(0,r.useState)([]),[O,Z]=(0,r.useState)("kg"),[A,Q]=(0,r.useState)(""),[U,G]=(0,r.useState)(""),[V,B]=(0,r.useState)(""),[Y,J]=(0,r.useState)(""),M=e=>{f(t=>t.filter((t,a)=>a!==e)),D(t=>{let a=t.filter((t,a)=>a!==e);return URL.revokeObjectURL(t[e]),a})},T=async s=>{s.preventDefault(),p(!0);try{let s=await q.t.getActor(),r=BigInt(Math.floor(1e8*parseFloat(V))),i=parseFloat(Y);if(isNaN(i))throw Error("Invalid quantity");let l=await s.createListing({title:A,description:U,price:r,quantity:i,unit:O,images:R,expiresAt:BigInt(1e6*Date.now()+6048e11)});if("ok"in l)t({title:"Success!",description:"Listing created successfully!"}),await Promise.all([u(),a()]),e.push("/listings");else throw Error(l.err)}catch(e){console.error("Failed to create listing:",e),t({title:"Error",description:e instanceof Error?e.message:"Failed to create listing. Please try again.",variant:"destructive"})}finally{p(!1)}};return(0,s.jsx)("div",{className:"min-h-screen bg-gradient-to-br from-green-50 to-blue-50 py-12 px-4 sm:px-6 lg:px-8",children:(0,s.jsxs)("div",{className:"max-w-3xl mx-auto",children:[(0,s.jsxs)("div",{className:"text-center mb-8",children:[(0,s.jsx)("h1",{className:"text-3xl font-bold text-gray-900",children:"Create New Listing"}),(0,s.jsx)("p",{className:"mt-2 text-gray-600",children:"Share your food items with the community and reduce waste"})]}),(0,s.jsxs)(l.Zb,{className:"backdrop-blur-sm bg-white/90 shadow-xl border-0",children:[(0,s.jsx)(l.Ol,{children:(0,s.jsx)(l.ll,{children:"Listing Details"})}),(0,s.jsx)(l.aY,{children:(0,s.jsxs)("form",{onSubmit:T,className:"space-y-6",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{htmlFor:"title",children:"Title"}),(0,s.jsx)(d.I,{id:"title",value:A,onChange:e=>Q(e.target.value),placeholder:"e.g., Fresh Organic Vegetables",required:!0,maxLength:100,className:"w-full"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{htmlFor:"description",children:"Description"}),(0,s.jsx)(o,{id:"description",value:U,onChange:e=>G(e.target.value),placeholder:"Describe your food items, quantity, and condition...",required:!0,maxLength:1e3,className:"min-h-[100px]"})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{htmlFor:"price",children:"Price (ICP)"}),(0,s.jsx)("div",{className:"relative",children:(0,s.jsx)(d.I,{id:"price",type:"number",step:"0.000000001",value:V,onChange:e=>B(e.target.value),placeholder:"0.00",required:!0,className:"pl-8"})})]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{htmlFor:"quantity",children:"Quantity"}),(0,s.jsxs)("div",{className:"grid grid-cols-2 gap-2",children:[(0,s.jsx)(d.I,{id:"quantity",type:"number",step:"0.01",value:Y,onChange:e=>J(e.target.value),required:!0,placeholder:"0.00"}),(0,s.jsxs)(I.Ph,{value:O,onValueChange:e=>Z(e),children:[(0,s.jsx)(I.i4,{children:(0,s.jsx)(I.ki,{placeholder:"Unit"})}),(0,s.jsxs)(I.Bw,{children:[(0,s.jsx)(I.Ql,{value:"kg",children:"Kilograms (kg)"}),(0,s.jsx)(I.Ql,{value:"g",children:"Grams (g)"}),(0,s.jsx)(I.Ql,{value:"pieces",children:"Pieces"}),(0,s.jsx)(I.Ql,{value:"litres",children:"Litres (L)"}),(0,s.jsx)(I.Ql,{value:"ml",children:"Millilitres (ml)"})]})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsx)(x,{children:"Expiry Date"}),(0,s.jsxs)(v,{children:[(0,s.jsx)(b,{asChild:!0,children:(0,s.jsxs)(n.z,{variant:"outline",className:(0,c.cn)("w-full justify-start text-left font-normal",!j&&"text-muted-foreground"),children:[(0,s.jsx)(_.Z,{className:"mr-2 h-4 w-4"}),j?(0,w.ZP)(j,"PPP"):"Select date"]})}),(0,s.jsx)(N,{className:"w-auto p-0",children:(0,s.jsx)(y,{mode:"single",selected:j,onSelect:L,disabled:e=>e<new Date,initialFocus:!0})})]})]})]}),(0,s.jsxs)("div",{className:"space-y-2",children:[(0,s.jsxs)(x,{children:["Images (",g.length,"/",5,")"]}),(0,s.jsxs)("div",{className:"grid grid-cols-2 md:grid-cols-3 gap-4",children:[R.map((e,t)=>(0,s.jsxs)("div",{className:"relative aspect-square",children:[(0,s.jsx)(S(),{src:e,alt:"Preview ".concat(t+1),fill:!0,className:"object-cover rounded-lg"}),(0,s.jsx)(n.z,{type:"button",variant:"destructive",size:"icon",className:"absolute top-2 right-2",onClick:()=>M(t),children:(0,s.jsx)(C.Z,{className:"h-4 w-4"})})]},t)),R.length<5&&(0,s.jsx)("div",{className:"aspect-square border-2 border-dashed rounded-lg flex items-center justify-center",children:(0,s.jsxs)("label",{className:"cursor-pointer flex flex-col items-center",children:[(0,s.jsx)(E.Z,{className:"h-8 w-8 text-gray-400"}),(0,s.jsx)("span",{className:"text-sm text-gray-500 mt-2",children:"Add Image"}),(0,s.jsx)("input",{type:"file",accept:"image/*",className:"hidden",onChange:e=>{if(e.target.files){let t=Array.from(e.target.files);f(e=>[...e,...t]);let a=t.map(e=>URL.createObjectURL(e));D(e=>[...e,...a])}},multiple:!0})]})})]}),(0,s.jsx)("p",{className:"text-sm text-gray-500",children:"Upload up to 5 images (PNG, JPG, JPEG)"})]}),(0,s.jsx)(n.z,{type:"submit",className:"w-full bg-gradient-to-r from-green-600 to-green-500 hover:from-green-700 hover:to-green-600",disabled:h||!j||0===g.length,children:h?(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(P.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Creating..."]}):"Create Listing"})]})})]})]})})}}},function(e){e.O(0,[395,258,314,950,769,437,836,691,971,864,744],function(){return e(e.s=2112)}),_N_E=e.O()}]);