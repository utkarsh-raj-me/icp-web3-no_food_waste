(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[311],{4442:function(e,r,s){Promise.resolve().then(s.bind(s,2361))},2361:function(e,r,s){"use strict";s.r(r),s.d(r,{default:function(){return E}});var t=s(7437),a=s(2265),l=s(6110),i=s(1908),n=s(3023),c=s(9213),d=s(9311);let o=(0,c.j)("inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-semibold transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",{variants:{variant:{default:"border-transparent bg-primary text-primary-foreground hover:bg-primary/80",secondary:"border-transparent bg-secondary text-secondary-foreground hover:bg-secondary/80",destructive:"border-transparent bg-destructive text-destructive-foreground hover:bg-destructive/80",outline:"text-foreground"}},defaultVariants:{variant:"default"}});function u(e){let{className:r,variant:s,...a}=e;return(0,t.jsx)("div",{className:(0,d.cn)(o({variant:s}),r),...a})}var x=s(8094),h=s(3715),m=s(5531);/**
 * @license lucide-react v0.446.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */let f=(0,m.Z)("ImageOff",[["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}],["path",{d:"M10.41 10.41a2 2 0 1 1-2.83-2.83",key:"1bzlo9"}],["line",{x1:"13.5",x2:"6",y1:"13.5",y2:"21",key:"1q0aeu"}],["line",{x1:"18",x2:"21",y1:"12",y2:"15",key:"5mozeu"}],["path",{d:"M3.59 3.59A1.99 1.99 0 0 0 3 5v14a2 2 0 0 0 2 2h14c.55 0 1.052-.22 1.41-.59",key:"mmje98"}],["path",{d:"M21 15V5a2 2 0 0 0-2-2H9",key:"43el77"}]]),p=(0,m.Z)("MapPin",[["path",{d:"M20 10c0 4.993-5.539 10.193-7.399 11.799a1 1 0 0 1-1.202 0C9.539 20.193 4 14.993 4 10a8 8 0 0 1 16 0",key:"1r0f0z"}],["circle",{cx:"12",cy:"10",r:"3",key:"ilqhr7"}]]);var y=s(6691),g=s.n(y),j=s(4430),v=s(6055),N=s(3015),b=s(3644),w=s(9314),k=s(4033);let C=e=>(Number(e)/1e8).toFixed(2),P=e=>(0,w.ZP)(Number(e)/1e6,"PPP"),S=e=>Number(e).toString();function E(){let{listings:e,refreshListings:r,refreshUserData:s,isLoading:c}=(0,b.useApp)(),{principal:d}=(0,N.useAuthContext)(),[o,m]=(0,a.useState)(""),[y,w]=(0,a.useState)("date"),[E,A]=(0,a.useState)("all"),[z,B]=(0,a.useState)(null),{toast:L}=(0,v.pm)(),M=(0,k.useRouter)();(0,a.useEffect)(()=>{r()},[r]);let Z=(0,a.useMemo)(()=>e.filter(e=>{let r=o.toLowerCase(),s=e.title.toLowerCase().includes(r)||e.description.toLowerCase().includes(r),t="all"===E||e.category===E;return s&&t}).sort((e,r)=>{switch(y){case"date":return Number(r.createdAt-e.createdAt);case"price":return Number(e.price-r.price);case"expiry":return Number(e.expiryDate-r.expiryDate);default:return 0}}),[e,o,y,E]),_=async(e,t)=>{B(e);try{let a=await j.t.getActor(),l=await a.createPurchase(e,t);if("ok"in l)await Promise.all([r(),s()]),L({title:"Success!",description:"Purchase successful!"});else throw Error(l.err)}catch(e){console.error("Failed to purchase:",e),L({title:"Error",description:e instanceof Error?e.message:"Failed to purchase. Please try again.",variant:"destructive"})}finally{B(null)}};if(c)return(0,t.jsx)("div",{className:"flex justify-center items-center min-h-screen",children:(0,t.jsx)(h.Z,{className:"h-8 w-8 animate-spin"})});let q=Array.from(new Set(e.map(e=>e.category)));return(0,t.jsxs)("div",{className:"container mx-auto px-4 py-8",children:[(0,t.jsxs)("div",{className:"mb-8",children:[(0,t.jsx)("h1",{className:"text-3xl font-bold text-gray-900 mb-4",children:"Browse Listings"}),(0,t.jsxs)("div",{className:"flex flex-col sm:flex-row gap-4",children:[(0,t.jsx)(i.I,{placeholder:"Search listings...",value:o,onChange:e=>m(e.target.value),className:"flex-1"}),(0,t.jsxs)(x.Ph,{value:E,onValueChange:e=>A(e),children:[(0,t.jsx)(x.i4,{className:"w-[180px]",children:(0,t.jsx)(x.ki,{placeholder:"Category"})}),(0,t.jsx)(x.Bw,{children:q.map(e=>(0,t.jsx)(x.Ql,{value:e,children:e.charAt(0).toUpperCase()+e.slice(1)},e))})]}),(0,t.jsxs)(x.Ph,{value:y,onValueChange:e=>w(e),children:[(0,t.jsx)(x.i4,{className:"w-[180px]",children:(0,t.jsx)(x.ki,{placeholder:"Sort by"})}),(0,t.jsxs)(x.Bw,{children:[(0,t.jsx)(x.Ql,{value:"date",children:"Sort by Date"}),(0,t.jsx)(x.Ql,{value:"price",children:"Sort by Price"}),(0,t.jsx)(x.Ql,{value:"expiry",children:"Sort by Expiry"})]})]})]})]}),0===Z.length?(0,t.jsxs)("div",{className:"text-center py-12",children:[(0,t.jsx)("h3",{className:"text-lg font-semibold text-gray-900",children:"No listings found"}),(0,t.jsx)("p",{className:"text-gray-600 mt-2",children:o?"Try adjusting your search terms":"Be the first to create a listing!"}),!o&&(0,t.jsx)(n.z,{onClick:()=>M.push("/create-listing"),className:"mt-4",children:"Create Listing"})]}):(0,t.jsx)("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:Z.map(e=>(0,t.jsxs)(l.Zb,{className:"overflow-hidden",children:[(0,t.jsx)("div",{className:"relative aspect-square",children:0===e.images.length?(0,t.jsx)("div",{className:"w-full h-full flex items-center justify-center bg-gray-100",children:(0,t.jsx)(f,{className:"w-12 h-12 text-gray-400"})}):(0,t.jsx)("div",{className:"relative w-full h-full",children:(0,t.jsx)(g(),{src:e.images[0],alt:e.title,fill:!0,className:"object-cover",priority:!0,onError:e=>{let r=e.target;r.src="/placeholder.jpg"}})})}),(0,t.jsxs)(l.Ol,{children:[(0,t.jsx)(l.ll,{children:e.title}),(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsx)("p",{className:"text-sm text-gray-500",children:P(e.createdAt)}),(0,t.jsxs)(u,{variant:"secondary",children:[C(e.price)," ICP"]})]})]}),(0,t.jsxs)(l.aY,{children:[(0,t.jsx)("p",{className:"text-gray-600 mb-4",children:e.description}),(0,t.jsxs)("div",{className:"flex flex-col gap-2 mb-4",children:[(0,t.jsxs)("div",{className:"flex justify-between items-center",children:[(0,t.jsxs)(u,{variant:"outline",children:["Quantity: ",S(e.quantity)]}),(0,t.jsxs)(u,{variant:"outline",className:"text-orange-600",children:["Expires: ",P(e.expiryDate)]})]}),(0,t.jsxs)("div",{className:"flex items-center gap-2 text-sm text-gray-500",children:[(0,t.jsx)(p,{className:"h-4 w-4"}),(0,t.jsx)("span",{children:e.location.address})]}),(0,t.jsx)(u,{variant:"secondary",className:"w-fit",children:e.category})]}),e.sellerId.toString()===(null==d?void 0:d.toString())?(0,t.jsx)(n.z,{className:"w-full",variant:"outline",disabled:!0,children:"Your Listing"}):(0,t.jsx)(n.z,{onClick:()=>_(e.id,e.quantity),disabled:z===e.id,className:"w-full",children:z===e.id?(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(h.Z,{className:"mr-2 h-4 w-4 animate-spin"}),"Buying..."]}):"Buy Now"})]})]},e.id))})]})}}},function(e){e.O(0,[395,258,314,950,769,437,691,971,864,744],function(){return e(e.s=4442)}),_N_E=e.O()}]);